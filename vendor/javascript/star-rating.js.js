function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||false;s.configurable=true;"value"in s&&(s.writable=true);Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){t&&_defineProperties(e.prototype,t);i&&_defineProperties(e,i);return e}var e={classNames:{active:"gl-active",base:"gl-star-rating",selected:"gl-selected"},clearable:true,maxStars:10,prebuilt:false,stars:null,tooltip:"Select a Rating"};var t=function addRemoveClass(e,t,i){e.classList[t?"add":"remove"](i)};var i=function createSpanEl(e){var t=document.createElement("span");e=e||{};for(var i in e)t.setAttribute(i,e[i]);return t};var s=function inRange(e,t,i){return/^\d+$/.test(e)&&t<=e&&e<=i};var n=function insertSpanEl(e,t,s){var n=i(s);e.parentNode.insertBefore(n,t?e.nextSibling:e);return n};var a=function merge(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s={};t.forEach((function(e){Object.keys(e||{}).forEach((function(i){if(void 0!==t[0][i]){var n=e[i];"Object"!==r(n)||"Object"!==r(s[i])?s[i]=n:s[i]=merge(s[i],n)}}))}));return s};var r=function type(e){return{}.toString.call(e).slice(8,-1)};var l=function values(e){var values=[];[].forEach.call(e.options,(function(e){var t=parseInt(e.value,10)||0;t>0&&values.push({index:e.index,text:e.text,value:t})}));return values.sort((function(e,t){return e.value-t.value}))};var o=function(){function Widget(e,t){_classCallCheck(this,Widget);this.direction=window.getComputedStyle(e,null).getPropertyValue("direction");this.el=e;this.events={change:this.onChange.bind(this),keydown:this.onKeyDown.bind(this),mousedown:this.onPointerDown.bind(this),mouseleave:this.onPointerLeave.bind(this),mousemove:this.onPointerMove.bind(this),reset:this.onReset.bind(this),touchend:this.onPointerDown.bind(this),touchmove:this.onPointerMove.bind(this)};this.indexActive=null;this.indexSelected=null;this.props=t;this.tick=null;this.ticking=false;this.values=l(e);this.widgetEl=null;this.el.widget&&this.el.widget.destroy();s(this.values.length,1,this.props.maxStars)?this.build():this.destroy()}_createClass(Widget,[{key:"build",value:function build(){this.destroy();this.buildWidget();this.selectValue(this.indexSelected=this.selected(),false);this.handleEvents("add");this.el.widget=this}},{key:"buildWidget",value:function buildWidget(){var e=this;var t,s;if(this.props.prebuilt){t=this.el.parentNode;s=t.querySelector("."+this.props.classNames.base+"--stars")}else{t=n(this.el,false,{class:this.props.classNames.base});t.appendChild(this.el);s=n(this.el,true,{class:this.props.classNames.base+"--stars"});this.values.forEach((function(t,n){var a=i({"data-index":n,"data-value":t.value});"function"===typeof e.props.stars&&e.props.stars.call(e,a,t,n);[].forEach.call(a.children,(function(e){return e.style.pointerEvents="none"}));s.innerHTML+=a.outerHTML}))}t.dataset.starRating="";t.classList.add(this.props.classNames.base+"--"+this.direction);this.props.tooltip&&s.setAttribute("role","tooltip");this.widgetEl=s}},{key:"changeIndexTo",value:function changeIndexTo(e,i){var s=this;if(this.indexActive!==e||i){[].forEach.call(this.widgetEl.children,(function(i,n){t(i,n<=e,s.props.classNames.active);t(i,n===s.indexSelected,s.props.classNames.selected)}));this.widgetEl.setAttribute("data-rating",e+1);if("function"!==typeof this.props.stars&&!this.props.prebuilt){this.widgetEl.classList.remove("s"+10*(this.indexActive+1));this.widgetEl.classList.add("s"+10*(e+1))}if(this.props.tooltip){var n;var a=e<0?this.props.tooltip:null===(n=this.values[e])||void 0===n?void 0:n.text;this.widgetEl.setAttribute("aria-label",a)}this.indexActive=e}this.ticking=false}},{key:"destroy",value:function destroy(){this.indexActive=null;this.indexSelected=this.selected();var e=this.el.parentNode;if(e.classList.contains(this.props.classNames.base)){if(this.props.prebuilt){this.widgetEl=e.querySelector("."+this.props.classNames.base+"--stars");e.classList.remove(this.props.classNames.base+"--"+this.direction);delete e.dataset.starRating}else e.parentNode.replaceChild(this.el,e);this.handleEvents("remove")}delete this.el.widget}},{key:"eventListener",value:function eventListener(e,t,i,s){var n=this;i.forEach((function(i){return e[t+"EventListener"](i,n.events[i],s||false)}))}},{key:"handleEvents",value:function handleEvents(e){var t=this.el.closest("form");t&&"FORM"===t.tagName&&this.eventListener(t,e,["reset"]);this.eventListener(this.el,e,["change"]);if("add"!==e||!this.el.disabled){this.eventListener(this.el,e,["keydown"]);this.eventListener(this.widgetEl,e,["mousedown","mouseleave","mousemove","touchend","touchmove"],false)}}},{key:"indexFromEvent",value:function indexFromEvent(e){var t,i;var s=(null===(t=e.touches)||void 0===t?void 0:t[0])||(null===(i=e.changedTouches)||void 0===i?void 0:i[0])||e;var n=document.elementFromPoint(s.clientX,s.clientY);return n.parentNode===this.widgetEl?[].slice.call(n.parentNode.children).indexOf(n):this.indexActive}},{key:"onChange",value:function onChange(){this.changeIndexTo(this.selected(),true)}},{key:"onKeyDown",value:function onKeyDown(e){var t=e.key.slice(5);if(~["Left","Right"].indexOf(t)){e.preventDefault();var i="Left"===t?-1:1;"rtl"===this.direction&&(i*=-1);var s=this.values.length-1;var n=-1;var a=Math.min(Math.max(this.selected()+i,n),s);this.selectValue(a,true)}}},{key:"onPointerDown",value:function onPointerDown(e){e.preventDefault();var t=this.indexFromEvent(e);this.props.clearable&&t===this.indexSelected&&(t=-1);this.selectValue(t,true)}},{key:"onPointerLeave",value:function onPointerLeave(e){var t=this;e.preventDefault();cancelAnimationFrame(this.tick);requestAnimationFrame((function(){return t.changeIndexTo(t.indexSelected)}))}},{key:"onPointerMove",value:function onPointerMove(e){var t=this;e.preventDefault();if(!this.ticking){this.tick=requestAnimationFrame((function(){return t.changeIndexTo(t.indexFromEvent(e))}));this.ticking=true}}},{key:"onReset",value:function onReset(){var e;var t=this.valueIndex(null===(e=this.el.querySelector("[selected]"))||void 0===e?void 0:e.value);this.selectValue(t||-1,false)}},{key:"selected",value:function selected(){return this.valueIndex(this.el.value)}},{key:"selectValue",value:function selectValue(e,t){var i;this.el.value=(null===(i=this.values[e])||void 0===i?void 0:i.value)||"";this.indexSelected=this.selected();false===t?this.changeIndexTo(this.selected(),true):this.el.dispatchEvent(new Event("change"))}},{key:"valueIndex",value:function valueIndex(e){return this.values.findIndex((function(t){return t.value===+e}))}}]);return Widget}();var u=function(){function StarRating(e,t){_classCallCheck(this,StarRating);this.destroy=this.destroy.bind(this);this.props=t;this.rebuild=this.rebuild.bind(this);this.selector=e;this.widgets=[];this.build()}_createClass(StarRating,[{key:"build",value:function build(){var t=this;this.queryElements(this.selector).forEach((function(i){var s=a(e,t.props,JSON.parse(i.getAttribute("data-options")));if("SELECT"===i.tagName&&!i.widget){!s.prebuilt&&i.parentNode.classList.contains(s.classNames.base)&&t.unwrap(i);t.widgets.push(new o(i,s))}}))}},{key:"destroy",value:function destroy(){this.widgets.forEach((function(e){return e.destroy()}));this.widgets=[]}},{key:"queryElements",value:function queryElements(e){return"HTMLSelectElement"===r(e)?[e]:"NodeList"===r(e)?[].slice.call(e):"String"===r(e)?[].slice.call(document.querySelectorAll(e)):[]}},{key:"rebuild",value:function rebuild(){this.destroy();this.build()}},{key:"unwrap",value:function unwrap(e){var t=e.parentNode;var i=t.parentNode;i.insertBefore(e,t);i.removeChild(t)}}]);return StarRating}();export{u as default};

