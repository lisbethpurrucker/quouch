import e from"suggestions";import t from"lodash.debounce";import i from"xtend";import n from"events";import o from"mapbox/lib/services/geocoding";var s={};s={"country.6646126669086080":{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},"country.12862386939497690":{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},"country.10299371396720960":{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},"country.15589894856372040":{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};var a=s;var l={};var r=e;var h=t;var c=i;var d=n.EventEmitter;var u=a;var p=o;function MapboxGeocoder(e){this._eventEmitter=new d;this.options=c({},this.options,e)}MapboxGeocoder.prototype={options:{placeholder:"Search",zoom:16,flyTo:true},onAdd:function(e){this._map=e;this.mapboxClient=new p(this.options.accessToken);this._onChange=this._onChange.bind(this);this._onKeyDown=this._onKeyDown.bind(this);this._onQueryResult=this._onQueryResult.bind(this);this._clear=this._clear.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var i=document.createElement("span");i.className="geocoder-icon geocoder-icon-search";this._inputEl=document.createElement("input");this._inputEl.type="text";this._inputEl.placeholder=this.options.placeholder;this._inputEl.addEventListener("keydown",this._onKeyDown);this._inputEl.addEventListener("change",this._onChange);var n=document.createElement("div");n.classList.add("geocoder-pin-right");this._clearEl=document.createElement("button");this._clearEl.className="geocoder-icon geocoder-icon-close";this._clearEl.addEventListener("click",this._clear);this._loadingEl=document.createElement("span");this._loadingEl.className="geocoder-icon geocoder-icon-loading";n.appendChild(this._clearEl);n.appendChild(this._loadingEl);t.appendChild(i);t.appendChild(this._inputEl);t.appendChild(n);this._typeahead=new r(this._inputEl,[],{filter:false});this._typeahead.getItemValue=function(e){return e.place_name};return t},onRemove:function(){this.container.parentNode.removeChild(this.container);this._map=null;return this},_onKeyDown:h((function(e){if(!e.target.value)return this._clearEl.style.display="none";e.metaKey||-1!==[9,27,37,39,13,38,40].indexOf(e.keyCode)||this._geocode(e.target.value)}),200),_onChange:function(){this._inputEl.value&&(this._clearEl.style.display="block");var e=this._typeahead.selected;if(e){if(this.options.flyTo)if(!u[e.id]&&(e.bbox&&e.context&&e.context.length<=3||e.bbox&&!e.context)){var t=e.bbox;this._map.fitBounds([[t[0],t[1]],[t[2],t[3]]])}else u[e.id]?this._map.fitBounds(u[e.id].bbox):this._map.flyTo({center:e.center,zoom:this.options.zoom});this._eventEmitter.emit("result",{result:e})}},_geocode:function(e){this._loadingEl.style.display="block";this._eventEmitter.emit("loading");var t=this.mapboxClient.geocodeForward(e,this.options);t.then(function(e){this._loadingEl.style.display="none";var t=e.entity;if(t.features.length)this._clearEl.style.display="block";else{this._clearEl.style.display="none";this._typeahead.selected=null}this._eventEmitter.emit("results",t);this._typeahead.update(t.features)}.bind(this));t.catch(function(e){this._loadingEl.style.display="none";this._eventEmitter.emit("error",{error:e})}.bind(this));return t},_clear:function(){this._inputEl.value="";this._typeahead.selected=null;this._typeahead.clear();this._onChange();this._inputEl.focus();this._clearEl.style.display="none";this._eventEmitter.emit("clear")},_onQueryResult:function(e){var t=e.entity;if(t.features.length){var i=t.features[0];this._typeahead.selected=i;this._inputEl.value=i.place_name;this._onChange()}},query:function(e){this._geocode(e).then(this._onQueryResult);return this},setInput:function(e){this._inputEl.value=e;this._typeahead.selected=null;this._typeahead.clear();this._onChange();return this},on:function(e,t){this._eventEmitter.on(e,t);return this},off:function(e,t){this._eventEmitter.removeListener(e,t);return this}};l=MapboxGeocoder;var _=l;export default _;

